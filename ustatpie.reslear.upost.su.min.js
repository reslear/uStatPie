/*!
    uStatPie - v0.1 release, визуальная статистика онлайн пользователей и гостей
    (c) 2016 Korchevskiy Evgeniy (aka ReSLeaR-)
    ---
    vk.com/reslear | upost.su | github.com/reslear
    Released under the MIT @license.
!*/
!function(){"use strict";function t(t,e){for(var r in e)t.setAttribute(r,e[r]);return t}function e(t,r){for(var s in r)t[s]=Object(r[s])===r[s]?e(t[s],r[s]):r[s];return t}function r(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function s(t,e,r){var s=[2,0,1,1,1,2];return(r?t+" ":"")+e[t%100>4&&t%100<20?2:s[t%10<5?t%10:5]]}window.uStatPie=function(t,r,s,n,i){this.CONTAINER=document.querySelector(t||".stat-pie"),this.COLORS=e({back:"#F6F8FB",inner:"transparent",front:"#317AFC",user_text:"#6B7C99",guest_text:"red"},r||{}),this.COMMON=e({cx:50,cy:50,r:43,"stroke-width":7,"stroke-linecap":"round",fill:"transparent"},s||{}),this.SELECTOR=e({user:"#onl3 b",guest:"#onl2 b"},n||{}),this.SIZE=e({width:65,height:65},i||{}),this.init()},uStatPie.prototype.init=function(e,n){if(!this.CONTAINER)return!1;var i=t(r("svg"),{width:this.SIZE.width,height:this.SIZE.height,viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"}),u=this.dasharray(this.CONTAINER),o={"stat-pie--back":{stroke:this.COLORS.back},"stat-pie--front":{stroke:this.COLORS.front,"stroke-dasharray":u.val}};for(var p in o){var c=a(p,o[p],this.COMMON);i.appendChild(c)}var h=r("g");h.classList.add("stat-pie--g"),h.innerHTML+='<text text-anchor="middle" class="stat-pie--puser">'+u.percent.user+"</text>",h.innerHTML+='<text text-anchor="middle" class="stat-pie--pguest" dy="1.5rem">'+u.percent.guest+"</text>",i.appendChild(h),this.CONTAINER.innerHTML="",this.CONTAINER.appendChild(i);var d=document.createElement("div");d.classList.add("stat-pie--users"),d.innerHTML+='<div class="stat-pie--user"><b>'+u.num.user+"</b><span>"+s(u.num.user,["Пользователь","Пользователя","Пользователей"])+"</span></div>",d.innerHTML+='<div class="stat-pie--guest"><b>'+u.num.guest+"</b><span>"+s(u.num.guest,["Гость","Гостя","Гостей"])+"</span></div>",this.CONTAINER.appendChild(d)},uStatPie.prototype.update=function(){var t,e,r,n,i,a=this.dasharray.apply(this,arguments);(t=this.CONTAINER.querySelector(".stat-pie--front"))&&t.setAttribute("stroke-dasharray",a.val),(e=this.CONTAINER.querySelector(".stat-pie--puser"))&&(e.innerHTML=a.percent.user),(r=this.CONTAINER.querySelector(".stat-pie--pguest"))&&(r.innerHTML=a.percent.guest),(n=this.CONTAINER.querySelector(".stat-pie--user"))&&(n.innerHTML="<b>"+a.num.user+"</b><span>"+s(a.num.user,["Пользователь","Пользователя","Пользователей"])+"</span>"),(i=this.CONTAINER.querySelector(".stat-pie--guest"))&&(i.innerHTML="<b>"+a.num.guest+"</b><span>"+s(a.num.guest,["Гость","Гостя","Гостей"])+"</span>")},uStatPie.prototype.dasharray=function(t,e){var r=void 0!==e?{user:t,guest:e}:n(t,this.SELECTOR);return i(r,this.COMMON.r)};var n=function(t,e){if(!(t instanceof Node)){var r=t;t=document.createElement("div"),t.innerHTML=r}var s=t.querySelector(e.user),n=t.querySelector(e.guest);return s=s?s.innerHTML:0,n=n?n.innerHTML:0,{user:s,guest:n}},i=function(t,e){t.user=parseInt(t.user),t.guest=parseInt(t.guest);var r=2*Math.PI*e,s=100*t.user/(t.user+t.guest),n=s/100*r,i=r-n;n=i<10&&0!==i?n-10:n;var a=s<50?Math.ceil(s):Math.floor(s);return{val:n+" "+r,percent:{user:a+"%",guest:100-a+"%"},num:{user:t.user,guest:t.guest}}},a=function(s,n,i){var a=r("circle");return a.classList.add(s),n=e(i,n),a=t(a,n)}}();